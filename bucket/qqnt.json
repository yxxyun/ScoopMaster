{
    "homepage": "https://im.qq.com/pcqq/index.shtml",
    "description": "(LiteLoaderQQNT patch) An instant messaging software service developed by Tencent, build with Electron.",
    "license": {
        "identifier": "Proprietary",
        "url": "https://ti.qq.com/agreement/index.html"
    },
    "version": "9.9.15.240819",
    "architecture": {
        "64bit": {
            "url": "https://dldir1.qq.com/qqfile/qq/QQNT/Windows/QQ_9.9.15_240819_x64_01.exe#/dl.7z",
            "hash": "b1d41bc595814f4f08d9bdcf7b529c4fbd41d7d2d9d48a367817611911de636d"
        },
        "32bit": {
            "url": "https://dldir1.qq.com/qqfile/qq/QQNT/Windows/QQ_9.9.15_240819_x86_01.exe#/dl.7z",
            "hash": "ecb78cdacfc33add769778f375b793a78566fab5f93aa196b3777e1b5ab65a18"
        },
        "arm64": {
            "url": "https://dldir1.qq.com/qqfile/qq/QQNT/Windows/QQ_9.9.15_240819_arm64_01.exe#/dl.7z",
            "hash": "61476f00a2ce5245a2f8788b70179bbeb6a45aafc093a575689c01071fd3cebc"
        }
    },
    "extract_dir": "Files",
    "shortcuts": [
        [
            "QQ.exe",
            "QQ"
        ]
    ],
    "depends": [
        "LiteLoaderQQNT",
        "DllHijack"
    ],
    "pre_install": [
        "Import-Module $(Join-Path $(Find-BucketDirectory -Root -Name air) scripts/AirUtils.psm1)",
        "$patch_dll = \"$persist_dir\\dbghelp.dll\"",
        "if (!(Test-Path $patch_dll)) {",
        "    $hijack_dir = $(appdir 'DllHijack' $global)",
        "    $arch = switch ($architecture) {",
        "        'arm64' { 'arm64' }",
        "        '64bit' { 'x64' }",
        "        default { 'x86' }",
        "    }",
        "    Copy-Item -Path \"$hijack_dir\\dbghelp_$arch.dll\" -Destination \"$persist_dir\\dbghelp.dll\" -Force",
        "}",
        "$patch_json = \"$persist_dir\\resources\\app\\app_launcher\\PatchConfig.json\"",
        "if (!(Test-Path $patch_json)) {",
        "    $loader_dir = \"$(appdir LiteLoaderQQNT $global)\\current\"",
        "    $patch_config = @{ LLPath = $loader_dir } | ConvertTo-Json",
        "    WriteFile $patch_json $patch_config",
        "}",
        "Remove-Module -Name AirUtils"
    ],
    "persist": [
        "dbghelp.dll",
        "resources\\app\\app_launcher\\PatchConfig.json"
    ],
    "post_install": [
        "$versions_dir = \"$dir\\resources\\app\\versions\"",
        "Get-ChildItem $versions_dir -Filter '*.zip' | Select-Object -First 1 | ForEach-Object {",
        "    $destination = Join-Path $versions_dir $_.BaseName",
        "    Expand-Archive $_.FullName -DestinationPath $destination -Force",
        "    Remove-Item $_.FullName -Force",
        "}"
    ],
    "checkver": {
        "script": [
            "$html = Invoke-WebRequest -Uri \"https://im.qq.com/pcqq/index.shtml\" -UseBasicParsing",
            "$regex1 = '//.*/im.qq.com_new/.*/windowsDownloadUrl\\.js(\\?t=[0-9]+)?'",
            "$links = ([regex]::Matches($html.Content, $regex1)).value",
            "$allContent = $links | ForEach-Object { (Invoke-WebRequest -Uri ('https:' + $_) -UseBasicParsing).Content } | Out-String",
            "$regex2 = 'QQNT/Windows/QQ_([0-9.]+)_([0-9]+)_x64_01.exe'",
            "(([regex]::Matches($allContent, $regex2)).value | Sort-Object -Descending -CaseSensitive)[0] | Out-String"
        ],
        "regex": "QQNT/Windows/QQ_([\\d\\.]+)_([\\d]+)_x64_01.exe",
        "replace": "${1}.${2}"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://dldir1.qq.com/qqfile/qq/QQNT/Windows/QQ_$match1_$match2_x64_01.exe#/dl.7z"
            },
            "32bit": {
                "url": "https://dldir1.qq.com/qqfile/qq/QQNT/Windows/QQ_$match1_$match2_x86_01.exe#/dl.7z"
            },
            "arm64": {
                "url": "https://dldir1.qq.com/qqfile/qq/QQNT/Windows/QQ_$match1_$match2_arm64_01.exe#/dl.7z"
            }
        }
    }
}
