{
  "version": "143.0.7499.170",
  "description": "A browser plugin designed for the viewing of premium video content",
  "homepage": "https://www.widevine.com/",
  "license": {
    "identifier": "Proprietary",
    "url": "https://chromium.googlesource.com/chromium/src/third_party/+/master/widevine/LICENSE"
  },
  "architecture": {
    "64bit": {
      "url": "https://dl.google.com/release2/chrome/ac7ajtusblhl4xhi5sryyfujuqqa_143.0.7499.170/143.0.7499.170_chrome_installer_uncompressed.exe#/chrome.7z",
      "hash": "6a9f31038779de6c973fc02fad450b514a6c70c25825cc812f2ba53740203dce"
    },
    "32bit": {
      "url": "https://dl.google.com/release2/chrome/ac4odgd56567adajfb43z6weimbq_143.0.7499.170/143.0.7499.170_chrome_installer_uncompressed.exe#/chrome.7z",
      "hash": "45e431608c9489c8f6f111e7bd8ce51dbef0d23307e41e994a08ae36457cbaf5"
    }
  },
  "installer": {
    "script": [
      "$dest = \"$dir\\WidevineCdm\"",
      "$chromeBin = Join-Path $dir 'Chrome-bin'",
      "$versionDir = Join-Path $chromeBin $version",
      "# If already extracted by Scoop, copy directly",
      "if (Test-Path (Join-Path $versionDir 'WidevineCdm')) {",
      "  New-Item -ItemType Directory -Force -Path $dest | Out-Null",
      "  Copy-Item (Join-Path $versionDir 'WidevineCdm\\*') $dest -Force -Recurse",
      "  Remove-Item $chromeBin -Force -Recurse -ErrorAction SilentlyContinue | Out-Null",
      "} else {",
      "  # Locate source artifact (Scoop may rename EXE to chrome.7z)",
      "  $src = $null",
      "  if (Test-Path \"$dir\\chrome.7z\") { $src = \"$dir\\chrome.7z\" }",
      "  elseif (Test-Path \"$dir\\dl.7z\") { $src = \"$dir\\dl.7z\" }",
      "  else { $exe = Get-ChildItem -Path $dir -Filter '*_chrome_installer*.exe' -ErrorAction SilentlyContinue | Select-Object -First 1; if ($exe) { $src = $exe.FullName } }",
      "  if (-not $src) { throw \"No installer archive found (expected chrome.7z/dl.7z or *_chrome_installer*.exe)\" }",
      "  # First try extracting with 7z; if the artifact is an EXE (even renamed to .7z), this exposes .rsrc\\BN\\CHROME.7Z",
      "  & (Get-Command 7z).Source x \"$src\" \"-o$dir\" -y | Out-Null",
      "  $embedded = Join-Path $dir '.rsrc\\BN\\CHROME.7Z'",
      "  if (Test-Path $embedded) {",
      "    Expand-7zipArchive $embedded $dir -Removal",
      "    Remove-Item (Join-Path $dir '.rsrc') -Force -Recurse -ErrorAction SilentlyContinue | Out-Null",
      "  }",
      "  # If WidevineCdm still not present, try expanding the source as a regular 7z",
      "  if (-not (Test-Path (Join-Path $versionDir 'WidevineCdm'))) {",
      "    Expand-7zipArchive $src $dir -Removal",
      "  }",
      "  if (Test-Path (Join-Path $versionDir 'WidevineCdm')) {",
      "    New-Item -ItemType Directory -Force -Path $dest | Out-Null",
      "    Copy-Item (Join-Path $versionDir 'WidevineCdm\\*') $dest -Force -Recurse",
      "    Remove-Item $chromeBin -Force -Recurse -ErrorAction SilentlyContinue | Out-Null",
      "  } else {",
      "    throw \"WidevineCdm directory not found in extracted Chrome-bin\"",
      "  }",
      "}"
    ]
  },
  "checkver": {
    "url": "https://scoopinstaller.github.io/UpdateTracker/googlechrome/chrome.min.xml",
    "regex": "(?sm)<stable32><version>(?<version>[\\d.]+)</version>.+release2/chrome/(?<32>[\\w-]+)_.+<stable64>.+release2/chrome/(?<64>[\\w-]+)_.+</stable64>"
  },
  "autoupdate": {
    "architecture": {
      "64bit": {
        "url": "https://dl.google.com/release2/chrome/$match64_$version/$version_chrome_installer_uncompressed.exe#/chrome.7z",
        "hash": {
          "url": "https://scoopinstaller.github.io/UpdateTracker/googlechrome/chrome.min.xml",
          "xpath": "/chromechecker/stable64[version='$version']/sha256"
        }
      },
      "32bit": {
        "url": "https://dl.google.com/release2/chrome/$match32_$version/$version_chrome_installer_uncompressed.exe#/chrome.7z",
        "hash": {
          "url": "https://scoopinstaller.github.io/UpdateTracker/googlechrome/chrome.min.xml",
          "xpath": "/chromechecker/stable32[version='$version']/sha256"
        }
      }
    }
  }
}
