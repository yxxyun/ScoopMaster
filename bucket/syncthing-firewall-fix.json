{
   "$schema": "https://raw.githubusercontent.com/lukesampson/scoop/master/schema.json",
   "version": "1.0.0",
   "description": "Fix Syncthing firewall. This enables the basic firewall rules according to https://docs.syncthing.net/users/firewall.",
   "depends": "syncthing",
   "url": "https://raw.githubusercontent.com/silver886/scoop/master/bucket/syncthing-firewall-fix.json",
   "hash": "74ef212f8f6e302c3e1775172a166e7859603e1e4bd1a0529e1ae79f03f287b2",
   "notes": "This package needs to be reinstalled every time when `syncthing` is installed or upgraded.",
   "installer": {
      "script": [
         "if (-not (is_admin)) { abort 'This package requires admin privileges to install' }",
         "$syncthingExe = \"$(appdir syncthing)\\$((ConvertFrom-Json (Get-Content -Raw \"$(appdir syncthing)\\current\\manifest.json\")).version)\\syncthing.exe\"",
         "New-NetFirewallRule -Action Allow -Direction Inbound -Program \"$syncthingExe\" -DisplayName \"Syncthing Discovery ($app)\" -LocalPort 21027 -Protocol UDP > $null",
         "New-NetFirewallRule -Action Allow -Direction Inbound -Program \"$syncthingExe\" -DisplayName \"Syncthing Sync (TCP) ($app)\" -LocalPort 22000 -Protocol TCP > $null",
         "New-NetFirewallRule -Action Allow -Direction Inbound -Program \"$syncthingExe\" -DisplayName \"Syncthing Sync (QUIC) ($app)\" -LocalPort 22000 -Protocol UDP > $null"
      ]
   },
   "uninstaller": {
      "script": [
         "if (-not (is_admin)) { abort 'This package requires admin privileges to uninstall' }",
         "Remove-NetFirewallRule -DisplayName \"Syncthing Discovery ($app)\" > $null",
         "Remove-NetFirewallRule -DisplayName \"Syncthing Sync (TCP) ($app)\" > $null",
         "Remove-NetFirewallRule -DisplayName \"Syncthing Sync (QUIC) ($app)\" > $null"
      ]
   },
   "checkver": {
      "url": "https://raw.githubusercontent.com/silver886/scoop/master/bucket/syncthing-firewall-fix.json",
      "jsonpath": "$.version"
   },
   "autoupdate": {
      "url": "https://raw.githubusercontent.com/silver886/scoop/master/bucket/syncthing-firewall-fix.json"
   }
}
