{
   "$schema": "https://raw.githubusercontent.com/lukesampson/scoop/master/schema.json",
   "version": "1.0.0",
   "description": "Fix Syncthing firewall. This enables the basic firewall rules according to https://docs.syncthing.net/users/firewall.",
   "depends": "syncthing",
   "url": "https://raw.githubusercontent.com/silver886/scoop/master/LICENSE",
   "hash": "7e12e5df4bae12cb21581ba157ced20e1986a0508dd10d0e8a4ab9a4cf94e85c",
   "notes": "This package needs to be reinstalled every time when `syncthing` is installed or upgraded.",
   "installer": {
      "script": [
         "if (-not (is_admin)) { abort 'This package requires admin privileges to install' }",
         "$syncthingExe = \"$(appdir syncthing)\\$((ConvertFrom-Json (Get-Content -Raw \"$(appdir syncthing)\\current\\manifest.json\")).version)\\syncthing.exe\"",
         "New-NetFirewallRule -Action Allow -Direction Inbound -Program \"$syncthingExe\" -DisplayName \"Syncthing Discovery ($app)\" -LocalPort 21027 -Protocol UDP > $null",
         "New-NetFirewallRule -Action Allow -Direction Inbound -Program \"$syncthingExe\" -DisplayName \"Syncthing Sync (TCP) ($app)\" -LocalPort 22000 -Protocol TCP > $null",
         "New-NetFirewallRule -Action Allow -Direction Inbound -Program \"$syncthingExe\" -DisplayName \"Syncthing Sync (QUIC) ($app)\" -LocalPort 22000 -Protocol UDP > $null"
      ]
   },
   "uninstaller": {
      "script": [
         "if (-not (is_admin)) { abort 'This package requires admin privileges to uninstall' }",
         "Remove-NetFirewallRule -DisplayName \"Syncthing Discovery ($app)\" > $null",
         "Remove-NetFirewallRule -DisplayName \"Syncthing Sync (TCP) ($app)\" > $null",
         "Remove-NetFirewallRule -DisplayName \"Syncthing Sync (QUIC) ($app)\" > $null"
      ]
   }
}
