{
    "version": "3.2.4",
    "description": "Nuclei POC漏洞管理与验证可视化工具",
    "homepage": "https://github.com/perlh/Wavely",
    "license": "MIT",
    "url": "https://github.com/perlh/Wavely/releases/download/v3.2.4/Wavely-installer.zip",
    "hash": "sha256:请在此处添加文件的SHA256哈希值",
    "installer": {
        "script": [
            "# 解压下载的安装包",
            "Expand-Archive -Path \"$dir\\$fname\" -DestinationPath \"$dir\" -Force",
            "",
            "# 运行 NSIS 安装程序",
            "$installer = Get-ChildItem \"$dir\" -Filter 'Wavely-installer.exe' | Select-Object -First 1",
            "if ($installer) {",
            "    Write-Host '正在安装 Wavely...' -ForegroundColor Yellow",
            "    ",
            "    # NSIS 静默安装参数",
            "    $process = Start-Process -Wait -PassThru -FilePath \"$($installer.FullName)\" -ArgumentList '/S', \"/D=$dir\"",
            "    ",
            "    if ($process.ExitCode -eq 0) {",
            "        Write-Host 'Wavely 安装成功' -ForegroundColor Green",
            "    } else {",
            "        Write-Warning \"安装程序退出代码: $($process.ExitCode)\"",
            "    }",
            "} else {",
            "    Write-Error '未找到 Wavely-installer.exe'",
            "}"
        ]
    },
    "post_install": [
        "# 清理安装文件",
        "Remove-Item \"$dir\\$fname\" -Force -ErrorAction SilentlyContinue",
        "Get-ChildItem \"$dir\" -Filter 'Wavely-installer.exe' | Remove-Item -Force -ErrorAction SilentlyContinue",
        "",
        "# 验证安装结果",
        "if (Test-Path \"$dir\\Wavely.exe\") {",
        "    Write-Host 'Wavely 已成功安装' -ForegroundColor Green",
        "} else {",
        "    # 如果不在根目录，尝试在子目录中查找",
        "    $exePath = Get-ChildItem \"$dir\" -Recurse -Filter 'Wavely.exe' | Select-Object -First 1",
        "    if ($exePath) {",
        "        Write-Host \"找到 Wavely.exe 在: $($exePath.FullName)\" -ForegroundColor Yellow",
        "    } else {",
        "        Write-Warning '未找到 Wavely.exe，可能需要手动检查安装'",
        "    }",
        "}"
    ],
    "uninstaller": {
        "script": [
            "# 使用 Wavely 自带的卸载程序",
            "if (Test-Path \"$dir\\uninstall.exe\") {",
            "    Write-Host '正在卸载 Wavely...' -ForegroundColor Yellow",
            "    Start-Process -Wait -FilePath \"$dir\\uninstall.exe\" -ArgumentList '/S' -NoNewWindow",
            "} else {",
            "    # 备选方案：通过注册表查找卸载信息",
            "    $regPaths = @(",
            "        'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*'",
            "        'HKLM:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*'",
            "        'HKCU:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*'",
            "    )",
            "    ",
            "    $uninstallInfo = Get-ItemProperty -Path $regPaths -ErrorAction SilentlyContinue | ",
            "        Where-Object { $_.DisplayName -match 'Wavely' } | Select-Object -First 1",
            "    ",
            "    if ($uninstallInfo -and $uninstallInfo.UninstallString) {",
            "        Write-Host '通过注册表卸载 Wavely...' -ForegroundColor Yellow",
            "        $uninstallCmd = $uninstallInfo.UninstallString",
            "        ",
            "        # 处理带引号的路径",
            "        if ($uninstallCmd -match '^\"([^\"]+)\"') {",
            "            $uninstallExe = $matches[1]",
            "            $uninstallArgs = $uninstallCmd.Substring($matches[0].Length).Trim()",
            "        } else {",
            "            $firstSpace = $uninstallCmd.IndexOf(' ')",
            "            if ($firstSpace -gt 0) {",
            "                $uninstallExe = $uninstallCmd.Substring(0, $firstSpace)",
            "                $uninstallArgs = $uninstallCmd.Substring($firstSpace + 1)",
            "            } else {",
            "                $uninstallExe = $uninstallCmd",
            "                $uninstallArgs = ''",
            "            }",
            "        }",
            "        ",
            "        # 确保使用静默参数",
            "        if ($uninstallArgs -notmatch '/S') {",
            "            $uninstallArgs = \"$uninstallArgs /S\"",
            "        }",
            "        ",
            "        Start-Process -Wait -FilePath $uninstallExe -ArgumentList $uninstallArgs -NoNewWindow",
            "    } else {",
            "        Write-Error '未找到 Wavely 的卸载程序，可能需要手动卸载'",
            "    }",
            "}"
        ]
    },
    "bin": "Wavely.exe",
    "shortcuts": [
        ["Wavely.exe", "Wavely"]
    ],
    "checkver": {
        "github": "https://github.com/perlh/Wavely",
        "re": "releases/tag/v([\\d.]+)"
    },
    "autoupdate": {
        "url": "https://github.com/perlh/Wavely/releases/download/v$version/Wavely-installer.zip"
    }
}
