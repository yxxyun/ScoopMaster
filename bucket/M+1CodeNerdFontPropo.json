{
    "version": "3.4.0",
    "description": "Multiple styles and weights, many glyph sets (e.g. Kana glyphs)",
    "homepage": "https://github.com/ryanoasis/nerd-fonts",
    "license": "OFL-1.1-no-RFN",
    "url": "https://github.com/ryanoasis/nerd-fonts/releases/download/v3.4.0/MPlus.tar.xz",
    "hash": "9c03e388d0ff2e0bc28be9bf6ab95f1e0260c5828b3159b18867a9e7a1f17f7b",
    "installer": {
        "script": [
            "$filter = 'M\\+1CodeNerdFontPropo-.*\\.[ot]tf$'",
            "if (([Environment]::OSVersion.Version -lt [version]'10.0.17763') -and (-not $global)) {",
            "    Write-Error \"`nWindows prior to Windows 10 Version 1809 does not allow installation of fonts at the user level. Please install it globally.\" -ForegroundColor Red -ErrorAction Stop",
            "}",
            "Add-Type -AssemblyName PresentationCore, WindowsBase",
            "$fontDir = if ($global) { \"${env:WINDIR}\\Fonts\" } else { \"${env:LOCALAPPDATA}\\Microsoft\\Windows\\Fonts\" }",
            "$regDrive = if ($global) { 'HKLM:' } else { 'HKCU:' }",
            "$regKey = \"$regDrive\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Fonts\"",
            "$files = Get-ChildItem $dir -Recurse -File | Where-Object { $_.Name -match $filter }",
            "if ($files.Count -eq 0) {",
            "    Write-Error 'Failed to find fonts to install. Please recheck the filter.' -ErrorAction Stop",
            "}",
            "$junk = Get-ChildItem $dir -Recurse -File | Where-Object { ($_.Name -match '\\.(ttf|otf|ttc|otc|woff2?|eot|svgz?|s?css)$') -and ($_.Name -notmatch $filter) }",
            "foreach ($file in $junk) {",
            "    Remove-Item -Force -LiteralPath $file.FullName -ErrorAction SilentlyContinue",
            "}",
            "$fonts = @()",
            "foreach ($file in $files) {",
            "    if (-not ($file.Name -match '\\.(ttf|otf|ttc|otc)$')) {",
            "        Write-Error 'Unsupported font format. Please use TTF or OTF files.'",
            "        continue",
            "    }",
            "    $fileUri = [uri]::new($file.FullName)",
            "    $glyphTypeface = $null",
            "    $regValueName = $null",
            "    try {",
            "        $glyphTypeface = [System.Windows.Media.GlyphTypeface]::new($fileUri)",
            "        if ($null -ne $glyphTypeface) {",
            "            $culture = [System.Globalization.CultureInfo]::CurrentCulture",
            "            $fontFamilyName = $null",
            "            if (($null -ne $glyphTypeface.FamilyNames) -and ($glyphTypeface.FamilyNames.Count -ne 0)) {",
            "                if ($glyphTypeface.FamilyNames.ContainsKey($culture.LCID)) {",
            "                    $fontFamilyName = $glyphTypeface.FamilyNames[$culture.LCID]",
            "                } elseif ($glyphTypeface.FamilyNames.ContainsKey(0x0409)) {",
            "                    $fontFamilyName = $glyphTypeface.FamilyNames[0x0409] # en-US",
            "                }",
            "            }",
            "            $fontFaceName = $null",
            "            if (($null -ne $glyphTypeface.FaceNames) -and ($glyphTypeface.FaceNames.Count -ne 0)) {",
            "                if ($glyphTypeface.FaceNames.ContainsKey($culture.LCID)) {",
            "                    $fontFaceName = $glyphTypeface.FaceNames[$culture.LCID]",
            "                } elseif ($glyphTypeface.FaceNames.ContainsKey(0x0409)) {",
            "                    $fontFaceName = $glyphTypeface.FaceNames[0x0409] # en-US",
            "                }",
            "            }",
            "            if (($null -ne $fontFamilyName) -and ($null -ne $fontFaceName)) {",
            "                $fontFamilyName = $fontFamilyName.Trim()",
            "                $fontFaceName = $fontFaceName.Trim()",
            "                $regValueName = \"$fontFamilyName $fontFaceName (TrueType)\"",
            "            }",
            "        }",
            "    } finally {",
            "        $glyphTypeface = $null",
            "        [System.GC]::Collect()",
            "        [System.GC]::WaitForPendingFinalizers()",
            "    }",
            "    if ($null -eq $regValueName) {",
            "        Write-Warning \"Could not determine font family name from metadata; using filename instead.\"",
            "        $regValueName = $file.BaseName -replace '[-_]+', ' '",
            "    }",
            "    $font = [PSCustomObject]@{",
            "        File     = $file",
            "        Registry = $regValueName",
            "        Success  = $false",
            "    }",
            "    $fonts += $font",
            "    $fontPath = \"$fontDir\\$($file.Name)\"",
            "    $regValueData = if ($global) { $file.Name } else { $fontPath }",
            "    if (Test-Path -LiteralPath $fontPath) {",
            "        [System.GC]::Collect()",
            "        [System.GC]::WaitForPendingFinalizers()",
            "        [System.GC]::Collect()",
            "        try {",
            "            Remove-Item -LiteralPath $fontPath -Force -ErrorAction SilentlyContinue",
            "            Start-Sleep -Milliseconds 100",
            "        } catch {",
            "            Write-Error \"Failed to remove existing font file $($file.Name): $($_.Exception.Message)\"",
            "            continue",
            "        }",
            "    }",
            "    try {",
            "        Copy-Item -Force -LiteralPath $file.FullName -Destination $fontDir",
            "        $existingKey = Get-ItemProperty -Path $regKey -Name $regValueName -ErrorAction SilentlyContinue",
            "        if ($null -eq $existingKey) {",
            "            New-ItemProperty -Force -Path $regKey -Name $regValueName -Value $regValueData -PropertyType String -ErrorAction Stop | Out-Null",
            "        } else {",
            "            Set-ItemProperty -Force -Path $regKey -Name $regValueName -Value $regValueData -ErrorAction Stop | Out-Null",
            "        }",
            "        $font.Success = $true",
            "    } catch {",
            "        Write-Error \"Failed to install font $($file.Name): $($_.Exception.Message)\"",
            "    }",
            "}",
            "if ($fonts.Count -gt 0) {",
            "    $fonts | Select-Object @{Name = 'Font'; Expression = { $_.File.Name } }, Registry, Success | Format-Table -AutoSize",
            "}"
        ]
    },
    "uninstaller": {
        "script": [
            "$filter = 'M\\+1CodeNerdFontPropo-.*\\.[ot]tf$'",
            "Add-Type -AssemblyName PresentationCore, WindowsBase",
            "$fontDir = if ($global) { \"${env:WINDIR}\\Fonts\" } else { \"${env:LOCALAPPDATA}\\Microsoft\\Windows\\Fonts\" }",
            "$regDrive = if ($global) { 'HKLM:' } else { 'HKCU:' }",
            "$regKey = \"$regDrive\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Fonts\"",
            "$files = Get-ChildItem $dir -Recurse -File | Where-Object { $_.Name -match $filter }",
            "if ($files.Count -eq 0) {",
            "    Write-Error 'Failed to find fonts to install. Please recheck the filter.' -ErrorAction Stop",
            "}",
            "$fonts = @()",
            "foreach ($file in $files) {",
            "    if (-not ($file.Name -match '\\.(ttf|otf|ttc|otc)$')) {",
            "        Write-Error 'Unsupported font format. Please use TTF or OTF files.'",
            "        continue",
            "    }",
            "    $fileUri = [uri]::new($file.FullName)",
            "    $glyphTypeface = $null",
            "    $regValueName = $null",
            "    try {",
            "        $glyphTypeface = [System.Windows.Media.GlyphTypeface]::new($fileUri)",
            "        if ($null -ne $glyphTypeface) {",
            "            $culture = [System.Globalization.CultureInfo]::CurrentCulture",
            "            $fontFamilyName = $null",
            "            if (($null -ne $glyphTypeface.FamilyNames) -and ($glyphTypeface.FamilyNames.Count -ne 0)) {",
            "                if ($glyphTypeface.FamilyNames.ContainsKey($culture.LCID)) {",
            "                    $fontFamilyName = $glyphTypeface.FamilyNames[$culture.LCID]",
            "                } elseif ($glyphTypeface.FamilyNames.ContainsKey(0x0409)) {",
            "                    $fontFamilyName = $glyphTypeface.FamilyNames[0x0409] # en-US",
            "                }",
            "            }",
            "            $fontFaceName = $null",
            "            if (($null -ne $glyphTypeface.FaceNames) -and ($glyphTypeface.FaceNames.Count -ne 0)) {",
            "                if ($glyphTypeface.FaceNames.ContainsKey($culture.LCID)) {",
            "                    $fontFaceName = $glyphTypeface.FaceNames[$culture.LCID]",
            "                } elseif ($glyphTypeface.FaceNames.ContainsKey(0x0409)) {",
            "                    $fontFaceName = $glyphTypeface.FaceNames[0x0409] # en-US",
            "                }",
            "            }",
            "            if (($null -ne $fontFamilyName) -and ($null -ne $fontFaceName)) {",
            "                $fontFamilyName = $fontFamilyName.Trim()",
            "                $fontFaceName = $fontFaceName.Trim()",
            "                $regValueName = \"$fontFamilyName $fontFaceName (TrueType)\"",
            "            }",
            "        }",
            "    } finally {",
            "        $glyphTypeface = $null",
            "        [System.GC]::Collect()",
            "        [System.GC]::WaitForPendingFinalizers()",
            "    }",
            "    $font = [PSCustomObject]@{",
            "        File     = $file",
            "        Registry = $regValueName",
            "        Success  = $false",
            "    }",
            "    $fonts += $font",
            "    $fontPath = \"$fontDir\\$($file.Name)\"",
            "    if (Test-Path -LiteralPath $fontPath) {",
            "        [System.GC]::Collect()",
            "        [System.GC]::WaitForPendingFinalizers()",
            "        [System.GC]::Collect()",
            "        try {",
            "            Remove-Item -LiteralPath $fontPath -Force",
            "            Start-Sleep -Milliseconds 100",
            "        } catch {",
            "            Write-Error \"Failed to remove existing font file $($file.Name): $($_.Exception.Message)\"",
            "            continue",
            "        }",
            "    }",
            "    try {",
            "        Remove-ItemProperty -Path $regKey -Name $regValueName -ErrorAction Stop",
            "        $font.Success = $true",
            "    } catch {",
            "        Write-Error \"Failed to uninstall font $($file.Name): $($_.Exception.Message)\"",
            "    }",
            "}",
            "if ($fonts.Count -gt 0) {",
            "    $fonts | Select-Object @{Name = 'Font'; Expression = { $_.File.Name } }, Registry, Success | Format-Table -AutoSize",
            "}"
        ]
    },
    "checkver": {
        "url": "https://api.github.com/repos/ryanoasis/nerd-fonts/releases",
        "jsonpath": "$[*].assets[*].browser_download_url",
        "regex": "/v?([\\d.]+)/MPlus\\.tar\\.xz"
    },
    "autoupdate": {
        "url": "https://github.com/ryanoasis/nerd-fonts/releases/download/v$version/MPlus.tar.xz"
    }
}
