{
    "version": "8.1.1.3",
    "description": "phpStudy PHP调试环境集成包",
    "homepage": "https://www.xp.cn/",
    "license": "Freeware",
    "url": "https://public.xp.cn/upgrades/phpStudy_64.zip",
    "hash": "2500d9e0058c83d94df36d0f21379760b3446b265fdce7541913044e8e99c4aa",
    "installer": {
        "script": [
            "# 定义路径",
            "$mainExe = Join-Path $dir 'COM\\phpstudy_pro.exe'",
            "$installerExe = Join-Path $dir 'phpstudy_x64_8.1.1.3.exe'",
            "",
            "# 检查是否已经安装",
            "if (Test-Path $mainExe) {",
            "    Write-Host \"检测到已安装的phpStudy，跳过安装步骤\" -ForegroundColor Green",
            "    exit 0",
            "}",
            "",
            "# 显示安装说明",
            "Write-Host \"`n=== phpStudy 安装向导 ===\" -ForegroundColor Cyan",
            "Write-Host \"现在将启动phpStudy安装程序\" -ForegroundColor Yellow",
            "Write-Host \"请按照安装向导完成安装过程\" -ForegroundColor Green",
            "Write-Host \"`n重要提示：\" -ForegroundColor Red",
            "Write-Host \"- 安装程序需要管理员权限\"",
            "Write-Host \"- 请将安装路径设置为: $dir\"",
            "Write-Host \"- 安装过程中请允许所有权限请求\"",
            "",
            "# 启动安装程序并等待",
            "if (Test-Path $installerExe) {",
            "    Write-Host \"正在启动安装程序...\" -ForegroundColor Green",
            "    Write-Host \"安装程序启动后，请继续完成安装步骤\" -ForegroundColor Yellow",
            "    Write-Host \"安装完成后请关闭此窗口\" -ForegroundColor Yellow",
            "    ",
            "    # 以管理员身份运行安装程序",
            "    try {",
            "        $process = Start-Process -FilePath $installerExe -Verb RunAs -PassThru -ErrorAction Stop",
            "        Write-Host \"安装程序已启动 (PID: $($process.Id))\" -ForegroundColor Green",
            "    } catch {",
            "        Write-Host \"尝试以管理员身份运行失败，将尝试普通方式...\" -ForegroundColor Yellow",
            "        $process = Start-Process -FilePath $installerExe -PassThru",
            "    }",
            "    ",
            "    # 等待用户完成安装",
            "    Write-Host \"`n请完成phpStudy的安装过程\" -ForegroundColor Cyan",
            "    Write-Host \"安装完成后请返回此窗口并按Enter键继续...\" -ForegroundColor Green",
            "    Pause",
            "    ",
            "    # 检查是否安装成功",
            "    $attempts = 0",
            "    while ($attempts -lt 5 -and -not (Test-Path $mainExe)) {",
            "        $attempts++",
            "        Write-Host \"检测安装进度 ($attempts/5)...\" -ForegroundColor Yellow",
            "        Start-Sleep -Seconds 3",
            "    }",
            "    ",
            "    if (Test-Path $mainExe) {",
            "        Write-Host \"安装成功检测到主程序！\" -ForegroundColor Green",
            "        # 确保安装程序进程已结束",
            "        if ($process -and -not $process.HasExited) {",
            "            try { $process.Kill() } catch {}",
            "        }",
            "    } else {",
            "        Write-Host \"未检测到主程序，可能安装未完成或选择了不同路径\" -ForegroundColor Yellow",
            "        Write-Host \"请手动确认安装是否完成\" -ForegroundColor Yellow",
            "    }",
            "} else {",
            "    Write-Host \"错误：未找到安装程序\" -ForegroundColor Red",
            "    exit 1",
            "}"
        ]
    },
    "post_install": [
        "# 等待几秒确保安装完全完成",
        "Start-Sleep -Seconds 2",
        "",
        "# 定义路径",
        "$comDir = Join-Path $dir 'COM'",
        "$mainExe = Join-Path $comDir 'phpstudy_pro.exe'",
        "$installerExe = Join-Path $dir 'phpstudy_x64_8.1.1.3.exe'",
        "",
        "# 检查主程序是否存在",
        "if (Test-Path $mainExe) {",
        "    Write-Host \"`n=== 配置phpStudy ===\" -ForegroundColor Green",
        "    ",
        "    # 清理安装程序",
        "    if (Test-Path $installerExe) {",
        "        try {",
        "            Remove-Item $installerExe -Force -ErrorAction SilentlyContinue",
        "            Write-Host \"清理安装程序文件\" -ForegroundColor Green",
        "        } catch {",
        "            Write-Host \"无法删除安装程序，可能正在使用\" -ForegroundColor Yellow",
        "        }",
        "    }",
        "    ",
        "    Write-Host \"`n=== 安装完成 ===\" -ForegroundColor Cyan",
        "    Write-Host \"主程序位置: $mainExe\"",
        "} else {",
        "    Write-Host \"`n=== 警告 ===\" -ForegroundColor Yellow",
        "    Write-Host \"未找到phpStudy主程序，可能安装未完成\"",
        "    Write-Host \"请检查以下情况：\"",
        "    Write-Host \"1. 是否完成了安装过程？\"",
        "    Write-Host \"2. 是否将phpStudy安装到了其他目录？\"",
        "    Write-Host \"3. 安装程序是否出现错误？\"",
        "    Write-Host \"`n如果安装未完成，请手动运行: $dir\\phpstudy_x64_8.1.1.3.exe\"",
        "    Write-Host \"安装完成后，无需重新运行安装命令\"",
        "}"
    ],
    "bin": "COM\\phpstudy_pro.exe",
    "shortcuts": [
        [
            "COM\\phpstudy_pro.exe",
            "phpstudy_pro"
        ]
    ],
    "persist": [
        "WWW",
        "Extensions"
    ],
    "notes": [
        "phpStudy安装需要管理员权限，安装过程中请允许所有权限请求。",
        "建议将phpStudy安装到Scoop目录下（默认路径即可）。",
        "安装完成后，可以使用'phpstudy'命令启动程序。"
    ]
}
