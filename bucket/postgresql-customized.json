{
    "version": "0.0.1",
    "description": "自定义了自动备份功能的",
    "homepage": "https://www.postgresql.org",
    "license": {
        "identifier": "PostgreSQL"
    },
    "url": "https://github.com/excitoon/empty/releases/download/empty-1.0.7/empty-1.0.7.zip",
    "hash": "8739c76e681f900923b900c9df0ef75cf421d39cabb54650c4b9ad19b6a76d85",
    "depends": ["main/postgresql", "main/pwsh"],
    "installer": {
        "script": [
            "$backupScriptDir = Join-Path $(persistdir 'postgresql' $global) 'data\\backup_db.ps1'",
            "$pwshPath = (scoop which pwsh)",
            "$argString = \"-NoProfile -NoLogo -WindowStyle Hidden -ExecutionPolicy Bypass -Command \"\"& `'$backupScriptDir`'\"\"\"",
            "$Action = New-ScheduledTaskAction -Execute $pwshPath -Argument $argString",
            "",
            "$Trigger1 = New-ScheduledTaskTrigger -Daily -At 2am",
            "$Trigger2 = New-ScheduledTaskTrigger -Daily -At 2pm",
            "$Settings = New-ScheduledTaskSettingsSet -AllowStartIfOnBatteries -DontStopIfGoingOnBatteries -StartWhenAvailable",
            "",
            "Register-ScheduledTask -Action $Action -Trigger $Trigger1, $Trigger2 -TaskName 'PostgreSQL_AutoBackup' -Description '每日两次定时备份 PostgreSQL 数据库' -Settings $settings -RunLevel Highest -Force"
        ]
    },
    "uninstaller": {
        "script": [
            "Unregister-ScheduledTask -TaskName 'PostgreSQL_AutoBackup' -Confirm:$false"
        ]
    }
}
