{
    "version": "1.2.77.357.g6a28e474-429",
    "description": "A digital music service that gives you access to millions of songs.",
    "homepage": "https://www.spotify.com/",
    "license": {
        "identifier": "Freeware",
        "url": "https://www.spotify.com/legal/end-user-agreement/"
    },
    "url": "https://upgrade.scdn.co/upgrade/client/win32-x86_64/spotify_installer-1.2.77.357.g6a28e474-429.exe",
    "hash": "c04f0a8158476c6f96f64644fa5fcb4b2ed5998c4ada8fd14e2a058446874836",
    "installer": {
        "script": [
            "Start-Process -Wait \"$dir\\$fname\" -ArgumentList '/extract', \"`\"$dir`\"\"",
            "Remove-Item \"$dir\\$fname\", \"$dir\\SpotifyMigrator.exe\" -ErrorAction SilentlyContinue",
            "## Steps to block the built-in autoupdater ##",
            "$updateFile = \"$env:LOCALAPPDATA\\Spotify\\Update\"",
            "# Delete any remnant file or directory called Update (including modify-protected), unless it is readonly or hidden",
            "Remove-Item -Path \"$updateFile\" -Recurse -ErrorAction SilentlyContinue | Out-Null",
            "# Delete any remnant file or directory called Update (including readonly), unless it is modify-protected",
            "Remove-Item -Path \"$updateFile\" -Recurse -Force -ErrorAction SilentlyContinue | Out-Null",
            "# Exit if there already exists an autoupdate-blocking file called Update",
            "if (Test-Path -Path \"$updateFile\") { return }",
            "# Create a file called Update",
            "New-Item -Path \"$updateFile\" -ItemType File -Value \"Created by Scoop to block the built-in autoupdater.\" -Force -ErrorAction SilentlyContinue | Out-Null",
            "# Make the file readonly",
            "Set-ItemProperty -Path \"$updateFile\" -Name IsReadOnly -Value $true -ErrorAction SilentlyContinue | Out-Null",
            "# Make the file modify-protected from self",
            "$Ace = New-Object System.Security.AccessControl.FileSystemAccessRule(\"${env:username}\", \"Modify\", \"Deny\")",
            "$Acl = New-Object System.Security.AccessControl.FileSecurity",
            "$Acl.AddAccessRule($Ace)",
            "Set-Acl -Path \"$updateFile\" -AclObject $Acl -ErrorAction SilentlyContinue | Out-Null"
        ]
    },
    "shortcuts": [
        [
            "Spotify.exe",
            "Spotify"
        ]
    ],
    "uninstaller": {
        "script": [
            "if ($cmd -ne 'uninstall') { return }",
            "## Undoing the steps to block the built-in autoupdater ##",
            "$updateFile = \"$env:LOCALAPPDATA\\Spotify\\Update\"",
            "# Remove modify-protection for the Update file",
            "$Ace = New-Object System.Security.AccessControl.FileSystemAccessRule(\"${env:username}\", \"Modify\", \"Deny\")",
            "$Acl = New-Object System.Security.AccessControl.FileSecurity",
            "$Acl.RemoveAccessRule($Ace)",
            "Set-Acl -Path \"$updateFile\" -AclObject $Acl -ErrorAction SilentlyContinue | Out-Null",
            "# Delete the Update file",
            "Remove-Item -Path \"$updateFile\" -Recurse -Force -ErrorAction SilentlyContinue | Out-Null"
        ]
    },
    "checkver": {
        "url": "https://raw.githubusercontent.com/amd64fox/LoaderSpot/main/versions.json",
        "jsonpath": "$..[?(@.fullversion)].links.win.x64",
        "regex": "spotify_installer-([\\d.]+[^.]+)"
    },
    "autoupdate": {
        "url": "https://upgrade.scdn.co/upgrade/client/win32-x86_64/spotify_installer-$version.exe"
    }
}
