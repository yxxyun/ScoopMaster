{
    "version": "5.3.25.0",
    "description": "NetLimiter. Internet traffic control and monitoring tool designed for Windows.",
    "homepage": "https://www.netlimiter.com",
    "license": "Freeware",
    "notes": [
        "This application requires administrator privileges to install.",
        "Restarting system after installation is recommended.",
        "Some functions could behave incorrectly without restart."
    ],
    "url": "https://www.netlimiter.com/download/nl/netlimiter-5.3.25.0.exe",
    "hash": "ba6fcdae4f139f8fe6fd8dc1f4175d9b79d58289d54745717708ccbf4ae45dc7",
    "installer": {
        "script": [
            "# Check for admin rights",
            "$isAdmin = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)",
            "if (-not $isAdmin) {",
            "    Write-Host 'ERROR: Administrator privileges required!' -ForegroundColor Red",
            "    Write-Host 'Please run: sudo scoop install netlimiter' -ForegroundColor Yellow",
            "    exit 1",
            "}",
            "",
            "$installerPath = \"$dir\\netlimiter-$version.exe\"",
            "$logPath = \"$dir\\installation.log\"",
            "",
            "$process = Start-Process -FilePath $installerPath -ArgumentList '/exenoui', '/qn', \"APPDIR=`\"$dir`\"\", \"/l*v `\"$logPath`\"\" -Wait -NoNewWindow -PassThru",
            "",
            "if ($process.ExitCode -ne 0) {",
            "    Write-Host \"Installation failed with exit code: $($process.ExitCode)\" -ForegroundColor Red",
            "    exit $process.ExitCode",
            "}"
        ]
    },
    "post_install": [
        "$patcherUrl = 'https://github.com/Homeland-Community/NetLimiterPatcher/releases/download/v1.0.0/NetLimiterPatcher.exe'",
        "$patcherPath = \"$dir\\NetLimiterPatcher.exe\"",
        "",
        "if (Test-Path $patcherPath) {",
        "    Write-Host 'NetLimiterPatcher.exe already exists. Skipping download.' -ForegroundColor Yellow",
        "} else {",
        "    Write-Host 'Downloading NetLimiterPatcher...' -ForegroundColor Cyan",
        "    try {",
        "        Invoke-WebRequest -Uri $patcherUrl -OutFile $patcherPath -UseBasicParsing",
        "        Write-Host 'Download completed successfully.' -ForegroundColor Green",
        "    } catch {",
        "        Write-Host \"Failed to download patcher: $_\" -ForegroundColor Red",
        "        return",
        "    }",
        "}",
        "",
        "if (Test-Path $patcherPath) {",
        "    Write-Host 'Running NetLimiterPatcher...' -ForegroundColor Cyan",
        "    try {",
        "        Start-Process -FilePath $patcherPath -Wait -NoNewWindow",
        "        Write-Host 'Patcher executed successfully.' -ForegroundColor Green",
        "    } catch {",
        "        Write-Host \"Failed to run patcher: $_\" -ForegroundColor Red",
        "    }",
        "}"
    ],
    "uninstaller": {
        "script": [
            "$processes = @('NLClientApp', 'nlsvc', 'NLService')",
            "foreach ($proc in $processes) {",
            "    Get-Process -Name $proc -ErrorAction SilentlyContinue | Stop-Process -Force -ErrorAction SilentlyContinue",
            "}",
            "",
            "$services = @('nlsvc', 'NetLimiter')",
            "foreach ($svc in $services) {",
            "    $service = Get-Service -Name $svc -ErrorAction SilentlyContinue",
            "    if ($service -and $service.Status -eq 'Running') {",
            "        Stop-Service -Name $svc -Force -ErrorAction SilentlyContinue",
            "    }",
            "}",
            "",
            "Start-Sleep -Seconds 2",
            "",
            "$ID = Get-ItemProperty 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*', 'HKLM:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*' -ErrorAction SilentlyContinue | Where-Object { $_.DisplayName -like '*NetLimiter*' } | Select-Object -ExpandProperty PSChildName -First 1",
            "",
            "if ($ID) {",
            "    $logPath = \"$env:TEMP\\netlimiter_uninstall_$(Get-Date -Format 'yyyyMMdd_HHmmss').log\"",
            "    $process = Start-Process msiexec.exe -ArgumentList \"/x $ID /qn NL_CLEAN_SETTINGS=0 /l*v `\"$logPath`\"\" -Wait -NoNewWindow -PassThru",
            "    ",
            "    if ($process.ExitCode -eq 0) {",
            "        if (Test-Path $logPath) {",
            "            Remove-Item $logPath -Force -ErrorAction SilentlyContinue",
            "        }",
            "        Write-Host 'NetLimiter uninstalled successfully.' -ForegroundColor Green",
            "    } else {",
            "        Write-Host \"Uninstallation failed with exit code: $($process.ExitCode)\" -ForegroundColor Red",
            "    }",
            "}",
            "",
            "Start-Sleep -Seconds 3"
        ]
    },
    "shortcuts": [
        [
            "NLClientApp.exe",
            "NetLimiter"
        ]
    ],
    "checkver": {
        "url": "https://www.netlimiter.com/releases",
        "regex": ">Release ([\\d.]+)</a>"
    },
    "autoupdate": {
        "url": "https://www.netlimiter.com/download/nl/netlimiter-$version.exe"
    }
}
