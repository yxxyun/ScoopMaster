{
    "version": "5.3.25.0",
    "description": "NetLimiter. Internet traffic control and monitoring tool designed for Windows.",
    "homepage": "https://www.netlimiter.com",
    "license": "Freeware",
    "notes": [
        "Restarting system after installation is recommended.",
        "Some functions could behave incorrectly without restart."
    ],
    "url": "https://www.netlimiter.com/download/nl/netlimiter-5.3.25.0.exe",
    "hash": "ba6fcdae4f139f8fe6fd8dc1f4175d9b79d58289d54745717708ccbf4ae45dc7",
    "pre_install": [
        "$ErrorActionPreference = 'Stop'",
        "$isAdmin = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)",
        "if (-not $isAdmin) {",
        "    Write-Host ''",
        "    Write-Host 'ERROR: Administrator privileges required.' -ForegroundColor Red",
        "    ",
        "    if (Test-Path \"$dir\\$fname\") {",
        "        Remove-Item \"$dir\\$fname\" -Force -ErrorAction SilentlyContinue",
        "    }",
        "    ",
        "    exit 1",
        "}"
    ],
    "installer": {
        "script": [
            "Start-Process -FilePath \"$dir\\$fname\" -ArgumentList '/exenoui', '/qn', \"APPDIR=`\"$dir`\"\", \"/l*v `\"$dir\\installation.log`\"\" -Wait -WindowStyle Hidden | Out-Null"
        ]
    },
    "post_install": [
        "Start-Sleep -Seconds 5",
        "",
        "$patcherUrl = 'https://github.com/Homeland-Community/NetLimiterPatcher/releases/download/v1.0.0/NetLimiterPatcher.exe'",
        "$patcherPath = \"$dir\\NetLimiterPatcher.exe\"",
        "",
        "if (-not (Test-Path $patcherPath)) {",
        "    Invoke-WebRequest -Uri $patcherUrl -OutFile $patcherPath -UseBasicParsing",
        "}",
        "",
        "if (Test-Path $patcherPath) {",
        "    $job = Start-Job -ScriptBlock {",
        "        param($patcher, $workDir)",
        "        Set-Location $workDir",
        "        & $patcher 2>&1 | Out-Null",
        "    } -ArgumentList $patcherPath, $dir",
        "    ",
        "    Wait-Job -Job $job -Timeout 30 | Out-Null",
        "    Remove-Job -Job $job -Force -ErrorAction SilentlyContinue",
        "}"
    ],
    "pre_uninstall": [
        "$ErrorActionPreference = 'SilentlyContinue'",
        "",
        "Write-Host 'Stopping NetLimiter processes and services...' -ForegroundColor Yellow",
        "",
        "# Stop all NetLimiter processes",
        "$processes = @('NLClientApp', 'nlsvc', 'NLService', 'netlimiter')",
        "foreach ($proc in $processes) {",
        "    $running = Get-Process | Where-Object { $_.ProcessName -like \"*$proc*\" }",
        "    if ($running) {",
        "        Write-Host \"Stopping process: $($running.ProcessName)\" -ForegroundColor Cyan",
        "        $running | Stop-Process -Force",
        "    }",
        "}",
        "",
        "Start-Sleep -Seconds 2",
        "",
        "# Stop all NetLimiter services",
        "$services = Get-Service | Where-Object { ",
        "    $_.DisplayName -like '*NetLimiter*' -or ",
        "    $_.ServiceName -like '*netlimiter*' -or ",
        "    $_.ServiceName -like '*nlsvc*' -or",
        "    $_.ServiceName -like '*NLService*'",
        "}",
        "",
        "foreach ($svc in $services) {",
        "    if ($svc.Status -eq 'Running') {",
        "        Write-Host \"Stopping service: $($svc.ServiceName)\" -ForegroundColor Cyan",
        "        Stop-Service -Name $svc.ServiceName -Force",
        "        Start-Sleep -Seconds 1",
        "    }",
        "}",
        "",
        "Start-Sleep -Seconds 2",
        "",
        "# Verify all stopped",
        "$stillRunning = Get-Process | Where-Object { ",
        "    $_.ProcessName -like '*NLClientApp*' -or ",
        "    $_.ProcessName -like '*NLSvc*' -or ",
        "    $_.ProcessName -like '*NLService*'",
        "}",
        "",
        "if ($stillRunning) {",
        "    Write-Host 'WARNING: Some processes are still running. Forcing termination...' -ForegroundColor Red",
        "    $stillRunning | Stop-Process -Force",
        "    Start-Sleep -Seconds 2",
        "}",
        "",
        "Write-Host 'All NetLimiter processes and services stopped.' -ForegroundColor Green"
    ],
    "uninstaller": {
        "script": [
            "$ErrorActionPreference = 'SilentlyContinue'",
            "",
            "# Find uninstall string",
            "$uninstallKey = Get-ItemProperty 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*', 'HKLM:\\SOFTWARE\\WOW6432Node\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\*' | Where-Object { $_.DisplayName -like '*NetLimiter*' } | Select-Object -First 1",
            "",
            "if ($uninstallKey) {",
            "    $ID = $uninstallKey.PSChildName",
            "    Write-Host \"Uninstalling NetLimiter: $ID\" -ForegroundColor Green",
            "    ",
            "    $logPath = \"$env:TEMP\\netlimiter_uninstall.log\"",
            "    $arguments = \"/x `\"$ID`\" /qn NL_CLEAN_SETTINGS=0 /norestart /l*v `\"$logPath`\"\"",
            "    ",
            "    $process = Start-Process msiexec.exe -ArgumentList $arguments -Wait -NoNewWindow -PassThru",
            "    ",
            "    if ($process.ExitCode -eq 0) {",
            "        Write-Host 'NetLimiter uninstalled successfully' -ForegroundColor Green",
            "        Remove-Item $logPath -Force -ErrorAction SilentlyContinue",
            "    } else {",
            "        Write-Host \"Uninstall exit code: $($process.ExitCode)\" -ForegroundColor Yellow",
            "    }",
            "} else {",
            "    Write-Host 'NetLimiter not found in registry' -ForegroundColor Yellow",
            "}",
            "",
            "Start-Sleep -Seconds 2"
        ]
    },
    "shortcuts": [
        [
            "NLClientApp.exe",
            "NetLimiter"
        ]
    ],
    "checkver": {
        "url": "https://www.netlimiter.com/releases",
        "regex": ">Release ([\\d.]+)</a>"
    },
    "autoupdate": {
        "url": "https://www.netlimiter.com/download/nl/netlimiter-$version.exe"
    }
}
